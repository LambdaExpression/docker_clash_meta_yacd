# docker-compose.yml
version: '3.8'

services:
  clash-meta-yacd:
    build: .
    container_name: clash-meta-yacd
    restart: unless-stopped
    ports:
      - "7890:7890"      # HTTP/HTTPS 代理
      - "7891:7891"      # SOCKS5 代理
      - "7893:7893"      # 混合端口
      - "9090:9090"      # Clash API 端口
      - "8080:80"        # Web UI 端口
    volumes:
      # 挂载配置文件目录
      - ./clash-config:/config
      # 可选：挂载数据目录
      - ./clash-data:/data
    environment:
      # 可选环境变量
      - TZ=Asia/Shanghai
      - SECRET=your-secret-here  # 如果不设置，会自动生成
      - CLASH_HTTP_PORT=7890
      - CLASH_SOCKS_PORT=7891
      - CLASH_API_PORT=9090
      - WEB_UI_PORT=80
    cap_add:
      - NET_ADMIN        # 如果需要 TUN 模式
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv6.conf.all.forwarding=1
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
